'''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFAdd H in PDB protein files123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF'''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport os123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport commands123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom prody import *123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom Config import PDB_tar,pdb_PREFIX,temp_pdb_PREFIX123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom_dir = pdb_PREFIX123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFto_dir = temp_pdb_PREFIX123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdef add_hydrogens(filedir,pdbfilename,index):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    real_dir = os.path.join(filedir,pdbfilename)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    #cmd = 'babel -h {0} {0}'.format(real_dir)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    #os.system(cmd)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    #cmd = 'babel -d {0} {0}'.format(real_dir)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    #os.system(cmd)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    with open('repair.sh','w') as w:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# !/bin/bash\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -n 2\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -W 100:00\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -J reapir_{}\n'.format(index))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -o /home/yw174/job/addH/{}.out\n'.format(index))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -e /home/yw174/job/addH/{}.err\n'.format(index))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('# BSUB -q long\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('export PATH =$PATH:/home/yw174/usr/babel/bin/\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write('cd /home/yw174/program/pdb_sth\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        cmd = 'obminimize -cg -ff MMFF94 -h -n 500 {0}.pdb > {0}_hydro.pdb'.format(index)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        w.write(cmd+'\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    os.system('bsub < repair.sh')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdef split_receptors(pdbname,src,tardir):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    print src123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        parse= parsePDB(src)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    except:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        return 0123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    print 'here'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    if parse.select('nucleic') is not None:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        return 1123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    protein = parse.select('protein')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    if protein is None:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        return 2123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    return 3123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdef write_it(pdbname,src,tardir,index):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    parse = parsePDB(src)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    protein = parse.select('protein')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    if not os.path.exists(tardir):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        os.makedirs(tardir)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    writePDB(os.path.join(tardir,str(index)+'.pdb'),protein)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    return True123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFif __name__=='__main__':123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    N = 11549123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    prefix = '/home/yw174/pdb_data/addHdata'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    os.remove('error.txt')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    Succ = 0123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    Fail = 0123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    for i in range(N):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            file = os.path.join(prefix, '{}_hydro.pdb'.format(i + 1))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            parsePDB(file)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print str(i + 1) + ' is OK'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            Succ += 1123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print str(i + 1) + ' fails' +' ,try to move long queue'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            add_hydrogens(prefix,str(i+1)+'.pdb', str(i+1))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            with open('error.txt', 'a') as w:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                w.write(str(i + 1) + '\n')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            Fail += 1123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    print 'Succ: {}, Fail: {}'.format(Succ, Fail)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF