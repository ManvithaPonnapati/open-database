"""123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFgenerate report for the database123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF"""123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport os123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport sys123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport numpy as np 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport pandas as pd 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport config123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom db import database123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdb = database()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdataframe_dict = {}123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdef load_dataframe():123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    db.export()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    for table in db.tables.keys():123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            csv_path = os.path.join(config.table_dir, table+'.csv')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except IOError as e:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print e123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            continue123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        dataframe_dict[table] = pd.read_csv(csv_path)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFdef gather_state():123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    gather report for state123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    state_tables = [tab for tab in dataframe_dict.keys() if tab.endswith('state')]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    state_tables = sorted(state_tables)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    records = []123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    for table in state_tables:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        csv_path = os.path.join(config.table_dir,table+'.csv')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        df = pd.read_csv(csv_path)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        success_entrys = df[df['state'] == 1]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        success_num = len(success_entrys)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        failed_entrys = df[df['state'] == 0]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        failed_group = failed_entrys.groupby('comment')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        failed_count = []123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        for name, group in failed_group:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            failed_count.append(name, len(group))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print table123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print 'success : ', success_num123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if len(failed_count):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print 'failed : ' 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            for reason, num in failed_count:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                print "\t%d\t%s" % (num, reason)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print '\n\n'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFload_dataframe()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFgather_state()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF