import os123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport sys123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport sqlite3123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport config123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport time123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom config import lock123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom utils import lockit123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFimport csv123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFfrom collections import namedtuple, OrderedDict123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFtable = namedtuple('Table',['name','columns','primary_key'])123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFtables = {123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'atom_num':table(*['atom_num',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('name','text'),('type','text'),('atom','integer')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['name']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'rotable_bond':table(*['rotable_bond',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('ligand','text'),('rotable_bond','ingeter')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['ligand']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'resolution':table(*['resolution',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('pdb','text'),('experiment','text'),('resolution','real')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['pdb']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'split_state':table(*['split_state',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('pdb','text'),('state','integer'),('comment','text')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['pdb']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'similarity':table(*['similarity',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('ligand_a','text'),('ligand_b','text'),('finger_print','text'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('similarity','real')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['ligand_a,ligand_b']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'overlap':table(*['overlap',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('crystal_ligand','text'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('position','integer'),('overlap_ratio','real')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['docked_ligand', 'crystal_ligand', 'position']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'overlap_state':table(*['overlap_state',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('crystal_ligand','text'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('state','integer'),('comment','text')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['docked_ligand','crystal_ligand']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'rmsd':table(*['rmsd',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('crystal_ligand','text'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('position','ingeter'),('rmsd','real')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ['docked_ligand','crystal_ligand','position']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'rmsd_state':table(*['rmsd_state',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('crystal_ligand','text'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('state','integer'),('comment','text')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ['docked_ligand, crystal_ligand']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'native_contact':table(*['native_contact',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('position','integer'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('ratio_4_0','real'),('ratio_4_5','real')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ['docked_ligand','position']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'native_contact_state':table(*['native_contact_state',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('state','integer'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('comment','text')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ['docked_ligand']]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    'dock_state':table(*['dock_state',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        OrderedDict([('docked_ligand','text'),('state','integer'),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ('comment','text')]),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ['docked_ligand']])123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF}123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNFclass database:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def __init__(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.db_path = config.db_path123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.tables = tables123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.add_scoring_term_tabel()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.connect_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def connect_db(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print "connect to %s" % self.db_path123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.conn = sqlite3.connect(self.db_path)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.connect = True123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def backup_db(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        backup_db_path = self.db_path.replace('.', '_'+time.strftime("%Y-%m-%d-%H:%M:%S", time.gmtime()) +'.')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if os.path.exists(self.db_path):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            cmd = 'cp %s %s' % (self.db_path , backup_db_path)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            os.system(cmd)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print "backup database %s" % backup_db_path123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def backup_and_reset_db(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if os.path.exists(self.db_path):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.backup_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            cmd = 'rm %s' % self.db_path123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            os.system(cmd)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.connect_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.create_table()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    @lockit123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def insert(self, tabel, values, head=None):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        sql_values = [ '(' + ','.join(value) + ')' for value in values ]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt = 'INSERT INTO ' + tabel + ' '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if not head is None:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            stmt += (','.join(head))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ' VALUES '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ','.join(sql_values)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ';'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if not self.connect:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.connect_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.conn.execute(stmt)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except sqlite3.IntegrityError as e:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print "Integrity Error ",123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print e123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except Exception as e:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print e123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.conn.commit()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    @lockit123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def insert_or_replace(self, tabel, values, head=None):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        db_value = lambda x:'"%s"' % x if type(x).__name__ == 'str' else str(x)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        db_values = [ map(db_value, value) for value in values ]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print db_values123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        sql_values = [ '(' + ','.join(value) + ')' for value in db_values ]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print sql_values123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt = 'REPLACE INTO ' + tabel + ' '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if not head is None:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            stmt += '('+ ','.join(head) + ')'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ' VALUES '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ','.join(sql_values)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ';'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print stmt123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if not self.connect:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.connect_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.conn.execute(stmt)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except Exception as e:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print e123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.conn.commit()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    @lockit123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def insert_or_ignore(self, tabel, values, head):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        sql_values = [ '(' + ','.join(value) + ')' for value in values ]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt = 'INSERT OR IGNORE INTO ' + tabel + ' '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += (','.join(head))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ' VALUES '123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ','.join(sql_values)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt += ';'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        if not self.connect:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.connect_db()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        try:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.conn.execute(stmt)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        except Exception as e:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            print e123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.conn.commit()123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def create_table(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        for tab in tables.values():123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            stmt = 'create table '+ tab.name + ' ('123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            for key in tab.columns.keys():123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                stmt += key + ' ' + tab.columns[key]123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                if key in tab.primary_key:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                    stmt += ' not null ,'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                else:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF                    stmt += ' ,'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            stmt += 'primary key(' + ','.join(tab.primary_key) + '));'123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.conn.execute(stmt)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print "Create all %d tables" % len(tables)        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def create_tabel_old(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create the tabels that we gonna use123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt = []123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # atom num tabel123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append( '''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        CREATE TABLE ATOM_NUM123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (NAME       TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        TYPE        TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ATOM_NUM    INTEGER,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        PRIMARY KEY(NAME)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # rotable bond123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append( '''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        CREATE TABLE ROTABLE_BOND123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (LIGAND         TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ROTABLE_BOND    INTEGER,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        PRIMARY KEY(LIGAND)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        CREATE TABLE RESOLUTION123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (PDB        TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        RESOLUTION  REAL NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        PRIMARY KEY(PDB)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # parse stat123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append( '''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        CREATE TABLE SPLIT_STATE123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (PDB        TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        STATE       INTEGER,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        COMMENT     TEXT,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        PRIMARY KEY(PDB)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # tanimoto similarity123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append( '''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        CREATE TABLE SIMILARITY123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (LIGAND_A       TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        LIGAND_B        TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        FINGER_PRINT    TEXT NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        SIMILARITY      READ NOT NULL,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        PRIMARY KEY(LIGAND_A, LIGAND_B)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table similarity123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (ligand_a       text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ligand_b        text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # overlap123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table overlap123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        crystal_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        position            integer not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        overlap_ratio       real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand, crystal_ligand, position)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # overlap state123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table overlap_state123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand    text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        state             integer,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand);123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # rmsd 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table rmsd123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        crystal_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        position            integer,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        rmsd                real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand, crystal_ligand, position)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table rmsd_state123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        crystal_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        state               integer,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        comment             text,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand, crystal_ligand)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        # native contace 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table native_contact123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        position            integer not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ratio_4_0           read,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ratio_4_5           real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ratio_5_0           real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ratio_5_5           real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        ratio_6_0           real,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand, position)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        stmt.append('''123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        create table dock_state123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        (docked_ligand      text not null,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        state               integer,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        comment             text,123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        primary key(docked_ligand)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        );''')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        for s in stmt:123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            self.conn.execute(s)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        print "create all %d tabels" % len(stmt)123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    def add_scoring_term_tabel(self):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        columns of this tabel will determined by 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        the content of config.scoring_tems 123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        """123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        columns = []123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        columns.append(('ligand','text'))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        columns.append(('position','integer'))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        for row in open(config.scoring_terms):123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            row = row.strip().split('  ')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            col = row[1].replace(',',' ')123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            col = '"%s"' % col123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            columns.append((col,'real'))123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        self.tables['scoring_terms'] = table(*['scoring_terms',123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            OrderedDict(columns),123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF            ['ligand','position']])123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF        123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF    123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF123343DJNBFHJBJNKFJNBHDRFBNJKDJUNF